
{% extends "base.html" %}
{% block content %}
<div class="space-y-6">
    <div class="flex justify-between items-center">
        <h1 class="text-3xl font-bold text-gray-800">{{ category_name }}</h1>
        <a href="/add_todo" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Add New Task</a>
    </div>

    <div class="grid grid-cols-1 gap-4">
        {% for todo in todos %}
        {% if todo.category == category_name %}
        <div class="bg-white rounded-lg shadow p-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <input type="checkbox" 
                       class="h-5 w-5 text-indigo-600"
                       onchange="toggleComplete({{ todo.id }})"
                       {% if todo.completed %}checked{% endif %}>
                <span class="{% if todo.completed %}line-through text-gray-500{% endif %}">
                    {{ todo.task }}
                </span>
            </div>
            <div class="flex space-x-2">
                <button onclick="editTodo({{ todo.id }})" 
                        class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                    Edit
                </button>
                <form action="{{ url_for('delete_todo', todo_id=todo.id) }}" method="POST" class="inline">
                    <button type="submit" 
                            class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600">
                        Delete
                    </button>
                </form>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</div>

<script>
function toggleComplete(todoId) {
    fetch(`/toggle_complete/${todoId}`, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            }
        });
}

function editTodo(todoId) {
    const newTask = prompt('Enter new task name:');
    if (newTask) {
        fetch(`/update_todo/${todoId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ new_task: newTask })
        }).then(() => location.reload());
    }
}
</script>
{% endblock %}